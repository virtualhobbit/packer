{
  "builders": [
    {
      "name":                  "Utrecht",
      "type":                  "vsphere-iso",

      "vcenter_server":        "nl-utc-p-mgt-01.nl.mdb-lab.com",
      "username":              "{{user `username`}}",
      "password":              "{{user `password`}}",
      "insecure_connection":   true,

      "vm_name":               "Windows 10 (LC) (2004)",
      "datastore":             "vsanDatastore",
      "create_snapshot":       true,
      "cluster":               "{{user `cluster`}}",
      "network":               "{{user `network`}}",
      "boot_order":            "disk,cdrom",
      "convert_to_template":   false,

      "vm_version":            15,  
      "guest_os_type":         "windows9_64Guest",

      "communicator":          "winrm",
      "winrm_username":        "{{user `winrm_username`}}",
      "winrm_password":        "{{user `winrm_password`}}",

      "CPUs":                  2,
      "RAM":                   8192,
      "RAM_reserve_all":       true,

      "disk_controller_type":  "pvscsi",
      "disk_size":             51200,
      "disk_thin_provisioned": true,

      "network_card":          "vmxnet3",

      "iso_paths": [
        "[{{user `datastore_iso`}}] en-gb_windows_10_business_editions_version_2004_updated_may_2020_x64_dvd_783c55e0.iso",
        "[{{user `datastore_iso`}}] VMware-tools-windows-11.1.0-16036546.iso"
      ],

      "floppy_files": [
        "{{template_dir}}/setup/"
      ],
      "remove_cdrom":          true
    },
    {
      "name":                  "Southport",
      "type":                  "vsphere-iso",

      "vcenter_server":        "gb-srt-p-mgt-01.uk.mdb-lab.com",
      "username":              "{{user `username`}}",
      "password":              "{{user `password`}}",
      "insecure_connection":   true,

      "vm_name":               "Windows 10 (LC) (1903)",
      "datastore":             "SAS_R5",
      "create_snapshot":       true,
      "cluster":               "{{user `cluster`}}",
      "network":               "{{user `network`}}",
      "boot_order":            "disk,cdrom",
      "convert_to_template":   false,

      "vm_version":            15,  
      "guest_os_type":         "windows9_64Guest",

      "communicator":          "winrm",
      "winrm_username":        "{{user `winrm_username`}}",
      "winrm_password":        "{{user `winrm_password`}}",

      "CPUs":                  2,
      "RAM":                   8192,
      "RAM_reserve_all":       true,

      "disk_controller_type":  "pvscsi",
      "disk_size":             51200,
      "disk_thin_provisioned": true,

      "network_card":          "vmxnet3",

      "iso_paths": [
        "[{{user `datastore_iso`}}] en-gb_windows_10_business_editions_version_1903_x64_dvd_4170a06f.iso",
        "[{{user `datastore_iso`}}] VMware-tools-windows-11.1.0-16036546.iso"
      ],

      "floppy_files": [
        "{{template_dir}}/setup/"
      ],
      "remove_cdrom":          true
    }
  ],
  "provisioners": [
    {
      "type":                  "powershell",
      "inline": [
        "powercfg.exe /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c",
        "Get-AppXPackage -AllUsers | Where {($_.name -notlike \"Photos\") -and ($_.Name -notlike \"Calculator\") -and ($_.Name -notlike \"Store\")} | Remove-AppXPackage -ErrorAction SilentlyContinue",
        "Get-AppXProvisionedPackage -Online | Where {($_.DisplayName -notlike \"Photos\") -and ($_.DisplayName -notlike \"Calculator\") -and ($_.DisplayName -notlike \"Store\")} | Remove-AppXProvisionedPackage -Online -ErrorAction SilentlyContinue"     
      ]
    },
    {
      "type":                  "powershell",
      "scripts": [
        "{{template_dir}}/setup/certs.ps1",
        "{{template_dir}}/setup/bginfo.ps1",
        "{{template_dir}}/setup/agent.ps1",
        "{{template_dir}}/setup/dem.ps1",
        "{{template_dir}}/setup/appvolumes.ps1"
      ]
    },
    {
      "type":                   "windows-restart",
      "restart_timeout":        "30m"
    },
    {
      "type":                   "windows-update",
      "search_criteria":        "IsInstalled=0",
      "filters": [
        "exclude:$_.Title -like '*Preview*'",
        "include:$true"
      ]
    }
  ]
}
